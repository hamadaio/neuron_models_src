load_file("nrngui.hoc")xopen("$(NEURONHOME)/lib/hoc/noload.hoc")load_proc("nrnmainmenu")xopen("biophys_params.hoc")geom_nseg()parameters()//densities()drug()	init_channels()nruns = 0dtrun = 0.05tstopval = 50tonset = 5//xopen("session_EPSP.ses")//xopen("session_AP.ses")//xopen("session_sub.ses")xopen("session_go.ses")xopen("init_synapses_e2s.hoc")init_syn_params()nsyn = mloc.nrowinit_syns(nsyn)objref soma_voltage_traces, tvecsoma_voltage_traces = new Vector()soma_voltage_traces.record(&soma.v(0.5))tvec= new Vector()tvec.record(&t)objref svstatesvstate = new SaveState()objref fobjref f1objref vtraces[nsyn]proc arun() {		for s=0, nsyn-1 {  			cAMPAconn[s].delay = tonset			PRE[s].del_rel = tonset			cNMDA[s].gmax = 0			cAMPAconn[s].weight = 0			vtraces[s] = new Vector()		} 		finitialize(v_init)		init_channels()						f = new File("statese2s.dat")		svstate.fread(f)		f.close()		svstate.restore()		t = 0		dt = dtrun		Dt = dtrun		frecord_init()		continuerun(10*dtrun)		allsave = 1				for nruns = 1, nsyn {			init_channels()			finitialize(v_init)						f = new File("statese2s.dat")			svstate.fread(f)			f.close()			svstate.restore()			t = 0			dt = dtrun			Dt = dtrun			for s=0, nsyn-1 {  				cAMPAconn[s].delay = tonset				PRE[s].del_rel = tonset				cNMDA[s].gmax = 0				cAMPAconn[s].weight = 0			} 						s = nsyn - nruns			AMPAgmax =  AMPAgmaxset/1000000			for ss=s, nsyn-1 {  				cNMDA[ss].gmax = NMDAgmax				cAMPAconn[ss].weight = AMPAgmax			}							print "Active synapses: ", nruns //prints number of synapses with each run (re_init)								frecord_init()			continuerun(tstopval)						strdef filename			sprint(filename, "run_%d.dat", nruns)			f1 = new File()			f1.wopen(filename)			for ii=0,tvec.size()-1 f1.printf("%f\t %f\n",tvec.x[ii], soma_voltage_traces.x[ii])			f1.close()			vtraces[nruns-1].copy(soma_voltage_traces)			if (tvec.size() != 1+tstopval/dt) {				allsave = 0			}		}		if (allsave == 1) {			strdef filename			sprint(filename, "run_all.dat")			f1 = new File()			f1.wopen(filename)						for ii=0,tvec.size()-1 {				strdef lines				sprint(lines,"%f",tvec.x[ii])				for i=0,nsyn-1 {					sprint(lines,"%s\t%f", lines, vtraces[i].x[ii])				}				sprint(lines,"%s\n", lines)				f1.printf(lines)						}			f1.close()		}}objref hbox, ghbox = new HBox()hbox.intercept(1)	//all following creations go into the "hbox" boxxpanel("")xlabel("1 - 9 synapses will be activated")xbutton("Run & Analyze","arun()")xbutton("Stop","stoprun=1")xvalue("AMPA gmax (pS) = ", "AMPAgmaxset", 2 )xvalue("NMDA gmax (pS) = ", "NMDAgmax", 2 )xvalue("dt (ms) = ", "dtrun", 2 )xvalue("tstop (ms) = ", "tstopval", 2 )xvalue("Stimulation onset (ms) = ", "tonset", 2 )xpanel()hbox.intercept(0)	//ends intercept modehbox.map("Controls", 0, 200, 290, 600) //draw the box and its contents